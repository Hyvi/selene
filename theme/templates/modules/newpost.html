{% from selene import forms %}
{% set form = forms.NewPostForm() %}
{% set f = form.content.process_data(post.get('content', '')) %}
{% if 'status' in post %}
    {% set f = form.status.process_data(post['status']) %}
{% end %}
{% if 'text_type' in post %}
    {% set f = form.text_type.process_data(post['text_type']) %}
{% end %}
{% if message %}
    <div class="alert alert-error">
        {{ message }}
    </div>
{% end %}
{% if new %}
    <form class="form" action="/post/new" method="post">
{% else %}
    <form class="form" action="{{ '/post/%s/edit' % post['slug'] }}" method="post">
{% end %}
    <fieldset>
        {% if new %}
            <legend><h2>Write a new post</h2></legend>
        {% else %}
            <legend><h2>Edit post: {{ post.get('title', '') }}</h2></legend>
        {% end %}
        <div class="span12">
            <div class="span5">
                <div class="control-group">
                    {% raw form.title.label(class_="control-label") %}
                    <div class="controls">
                        {% raw form.title(value=post.get('title', ''), placeholder="Title", class_="input-block-level") %}
                    </div>
                </div>
                <div class="control-group">
                    {% raw form.tags.label(class_="control-label") %}
                    <div class="controls">
                        {% raw form.tags(value=','.join(post.get('tags', [])), placeholder="Tags", class_="input-block-level") %}
                    </div>
                </div>
                <div class="control-group">
                    {% raw form.slug.label(class_="control-label") %}
                    <div class="controls">
                        {% raw form.slug() %}
                        {% raw form.customslug(value=post.get('slug', ''), placeholder='Custom slug', class_="input-block-level") %}
                    </div>
                </div>
                <div class="control-group">
                    {% raw form.status.label(class_="control-label") %}
                    <div class="controls">
                        {% for subfield in form.status %}
                            {% raw subfield() %}
                            {% raw subfield.label() %}
                        {% end %}
                    </div>
                </div>
                <div class="control-group">
                    {% raw form.text_type.label(class_="control-label") %}
                    <div class="controls">
                        {% for subfield in form.text_type %}
                            {% raw subfield() %}
                            {% raw subfield.label() %}
                        {% end %}
                    </div>
                </div>
            </div>
            <div class="span6">
                <div class="control-group">
                    {% raw form.content.label(class_="control-label") %}
                    <div class="controls">
                        {% raw form.content(placeholder="Content", class_="input-block-level", rows="25") %}
                    </div>
                </div>
            </div>
            {% raw xsrf_form_html() %}
        </div>
    </fieldset>
    <div class="form-actions">
        {% if new %}
            <button type="submit" class="btn btn-primary">
                <i class="icon-ok"></i>Save it
            </button>
            <a href="/posts" class="btn">Cancel</a>
        {% else %}
            <button type="submit" class="btn btn-primary">
                <i class="icon-edit"></i>Edit
            </button>
            <a href="{{ '/post/%s' % post['slug'] }}" class="btn">Cancel</a>
        {% end %}
    </div>
</form>
